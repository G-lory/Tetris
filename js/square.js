class Square {
    // square coordinate is (x, y)
    // there are 7 kinds of square
    // every square has four direction, now direction is dir
    constructor(x, y) {
        this.x = x
        this.y = y
        this.type = Math.floor(Math.random()*7)
        this.dir = Math.floor(Math.random()*4)
        this.init()
        this.data = this.getSquare(this.type, this.dir)
    }

    down() {
        this.x++
    }

    up() {
        this.x--
    }

    left() {
        this.y--
    }

    right() {
        this.y++
    }

    rightRotate() {
        this.dir = (this.dir + 1) % 4
        this.data = this.getSquare(this.type, this.dir)
    }

    leftRotate() {
        this.dir = (this.dir + 3) % 4
        this.data = this.getSquare(this.type, this.dir)
    }

    fixed() {
        for (var i = 0; i < 4; i++) {
            for (var j = 0; j < 4; j++) {
                this.data[i][j] = this.data[i][j] && 1
            }
        }
    }

    getSquare(type, dir) {
        return this.squaresFactory[type][dir]
    }

    init() {
        this.squaresFactory = [
            // 第一种形状
            [
                [
                    [0, 2, 0, 0],
                    [0, 2, 0, 0],
                    [0, 2, 0, 0],
                    [0, 2, 0, 0],
                ],
                [
                    [0, 0, 0, 0],
                    [2, 2, 2, 2],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [0, 2, 0, 0],
                    [0, 2, 0, 0],
                    [0, 2, 0, 0],
                    [0, 2, 0, 0],
                ],
                [
                    [0, 0, 0, 0],
                    [2, 2, 2, 2],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
            ],
            // 第二种形状
            [
                [
                    [0, 2, 0, 0],
                    [2, 2, 2, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 0, 0, 0],
                    [2, 2, 0, 0],
                    [2, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 2, 2, 0],
                    [0, 2, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [0, 2, 0, 0],
                    [2, 2, 0, 0],
                    [0, 2, 0, 0],
                    [0, 0, 0, 0],
                ],
            ],
            // 第三种形状
            [
                [
                    [2, 2, 2, 0],
                    [0, 0, 2, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [0, 2, 0, 0],
                    [0, 2, 0, 0],
                    [2, 2, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 0, 0, 0],
                    [2, 2, 2, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 2, 0, 0],
                    [2, 0, 0, 0],
                    [2, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
            ],
            // 第四种形状
            [
                [
                    [2, 2, 2, 0],
                    [2, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 2, 0, 0],
                    [0, 2, 0, 0],
                    [0, 2, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [0, 0, 2, 0],
                    [2, 2, 2, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 0, 0, 0],
                    [2, 0, 0, 0],
                    [2, 2, 0, 0],
                    [0, 0, 0, 0],
                ],
            ],
            // 第五种形状
            [
                [
                    [2, 2, 0, 0],
                    [2, 2, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 2, 0, 0],
                    [2, 2, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 2, 0, 0],
                    [2, 2, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 2, 0, 0],
                    [2, 2, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
            ],
            // 第六种形状
            [
                [
                    [0, 2, 2, 0],
                    [2, 2, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 0, 0, 0],
                    [2, 2, 0, 0],
                    [0, 2, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [0, 2, 2, 0],
                    [2, 2, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 0, 0, 0],
                    [2, 2, 0, 0],
                    [0, 2, 0, 0],
                    [0, 0, 0, 0],
                ],
            ],
            // 第七种形状
            [
                [
                    [2, 2, 0, 0],
                    [0, 2, 2, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [0, 2, 0, 0],
                    [2, 2, 0, 0],
                    [2, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [2, 2, 0, 0],
                    [0, 2, 2, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                [
                    [0, 2, 0, 0],
                    [2, 2, 0, 0],
                    [2, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
            ]
        ]
    }
}